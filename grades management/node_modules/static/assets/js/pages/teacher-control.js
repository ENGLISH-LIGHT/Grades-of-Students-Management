$(function () {
    // 欢迎
    $('#all-content').empty().append('<div class="welcome"> welcome </div>');

    // 点击个人信息导航栏
    $('#nav-my-teacherInfo').click(function () {
        var $allContent = $('#all-content').empty();
        // 添加表单
        // var $clientSite = $('#all-context');
        var $formWrapper = $allContent.append('<div class="form-wrapper"></div>')
            .children('.form-wrapper');
        var $formTitle = $formWrapper.append('<div class="form-title">个人信息</div>')
            .children('.form-title');
        var $formBody = $formWrapper.append('<div class="form-body"></div>')
            .children('.form-body');
        // 往body中添加,一个一个的需要写入数据的 div
        var $teacherForm = $formBody.append('<form id="teacher-form" target="_self" action="teacher/updateInfo" method="POST">')
            .children('#teacher-form');
        $.get('teacher/teacher/getInfo',{Tno:'0001'} ,function (data) {
            var d = data[0];
            $teacherForm.append(`<div class="form-li" id="form-li1"><label class="col-lg-2 col-md-2 col-sm-12 control-label">教师编号:</label><div class="col-lg-10 col-md-10"><input value='${d.Tno}' type="text" name="Tno" class="form-control" placeholder="字符长度 < 10且不含有中文" autofocus="autofocus"></div></div>`)
                .append(`<div class="form-li" id="form-li2"><label class="col-lg-2 col-md-2 col-sm-12 control-label">姓&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp名:</label><div class="col-lg-10 col-md-10"><input value='${d.Tname}' name="Tname" type="text" class="form-control" placeholder="" autofocus="autofocus"></div></div>`)
                .append(`<div class="form-li" id="form-li3"><label class="col-lg-2 col-md-2 col-sm-12 control-label">性&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp别:</label><div class="col-lg-10 col-md-10"><input value='${d.Tsex}' name="Tsex" type="text" class="form-control" placeholder="输入"男"或"女",其他输入无效" autofocus="autofocus"></div></div>`)
                .append(`<div class="form-li" id="form-li4"><label class="col-lg-2 col-md-2 col-sm-12 control-label">电&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp话:</label><div class="col-lg-10 col-md-10"><input value='${d.Ttel}' name="Ttel" type="text" class="form-control" placeholder="请输入11位的电话号码，其他输入无效" autofocus="autofocus"></div></div>`)
                .append(`<div class="form-li" id="form-li5"><label class="col-lg-2 col-md-2 col-sm-12 control-label">邮&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp箱:</label><div class="col-lg-10 col-md-10"><input value='${d.Temail}' name="Temail" type="text" class="form-control" placeholder="请输入邮箱，不含有中文且长度不能超过30" autofocus="autofocus"></div></div>`)
                .append(`<div class="form-li" id="form-li6"><label class="col-lg-2 col-md-2 col-sm-12 control-label">评&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp价:</label><div class="col-lg-10 col-md-10"><input value='${d.Tremarks}' name="Tremarks" type="textarea" class="form-control" placeholder="请输入老师评价，长度不能超过500" autofocus="autofocus"></div></div>`)
            $teacherForm.append('<input type="submit" value="修  改" class="btn btn-success btn-block">')

        })

    })
    // 点击上传成绩导航栏
    $('#nav-up-grades').click(function(){
        var $allContent = $('#all-content').empty();
         //  添加小标题div 和 表主体div
        $allContent.empty().addClass('out-border')
            .append('<div id="main-title" class="panel-heading white-bg"></div>')
            .append('<div class="panel-body"></div>');
        var $titleDiv = $('#all-content>.panel-heading');
        var $bodyDiv = $('#all-content>.panel-body');
        // 给头div添加内容<h4>
        $titleDiv.empty().append('<h4 class="panel-title">上传成绩</h4>')
        // 添加显示数据条数
        // $titleDiv.append('<div><div class="mydata_count"><label><span><select id="sel" size="1" name="datatable_length"><option value="3" selected="selected">3</option><option value="5">5</option><option value="10">10</option><option value="50">50</option></select></span>条数据</label></div><div><div id="datatable_filter"><label><input type="text" class="form-control input-large" placeholder="Search"></label></div></div></div>')
         // 数据操作按钮div
         $allContent.append('<div class="show-data up-grades-div"></div>');
        var $dataCount = $allContent.children('.show-data');
         var $btnHandle = $dataCount.append('<div class="up-grades btn-handle"></div>').children(".btn-handle");
         $dataCount.append('<input id="upload-Lno" value="0002" type="text" name="Lno" placeholder="课程号" autofocus="autofocus">')
                .append('<input id="upload-Sno" type="text" name="Sno" value="5120150001" placeholder="学号" autofocus="autofocus">')
                .append('<input id="upload-marks" type="text" name="Gscore" placeholder="分数" autofocus="autofocus">');
          // 操作按钮
        //   <input value='${d.Tno}' type="text" name="Tno" class="form-control" placeholder="字符长度 < 10且不含有中文" autofocus="autofocus">
          $btnHandle.append('<button id="btn-update" class="btn btn-primary">添加<button id="btn-insert" class="btn btn-primary btn-up-grade">提交</button><button id="btn-insert" class="btn btn-primary btn-up-grade">修改</button>');
        //添加表格头部
        $bodyDiv.empty().append('<table class="table display" id="datatable1"></table>')
        var $table = $('.panel-body>.display');
       
            $table.append('<tbody></tbody>');
            var $body = $table.children('tbody');
            $table.empty()
            .append('<thead><tr><th>序号</th><th>课程代号</th><th>学号</th><th>分数</th></tr></thead>')
            .append($body)
            .append('<tfoot><tr><th>序号</th><th>课程代号</th><th>学号</th><th>分数</th></tr></tfoot>');
            var upLoadDates = [];
            var ID = 0;
            // 添加到表格
            $('#btn-update').click(function(){
                var Lno = $('#upload-Lno').attr('value'),Sno = $('#upload-Sno').attr('value'),Gscore = $('#upload-marks').attr('value');
                if(Lno===""||Sno===""||Gscore===""){
                    alert("数据不完整");
                    return;
                }else{
                    upLoadDates.push({
                        ID:ID++,
                        Lno:Lno,
                        Sno:Sno,
                        Gscore:Gscore
                    });
                    // 添加数据项到tbody中
                    var strTds = '<td>' + ID + '</td>'
                        + '<td>' + Lno + '</td>'
                        + '<td>' + Sno + '</td>'
                        + '<td>' + Gscore + '</td>';
                    var newTr = document.createElement('tr');
                    $(newTr).append(strTds).appendTo($body);
                }
            })
            // 提交到数据库
            $('#btn-insert').click(function(){
                for(var i = 0; i < upLoadDates.length; i++){
                    $.post('/grade/teacher/uploadGrades',upLoadDates[i],function(data){
                        console.log(data);
                    })
                }
            })
    })

    // 点击查看自己所教课程的学生成绩
    $('#nav-look-grades').click(function(){
        var $allContent = $('#all-content').empty();
         //  添加小标题div 和 表主体div
        $allContent.empty().addClass('out-border')
            .append('<div id="main-title" class="panel-heading white-bg for-GPA"></div>')
            .append('<div class="panel-body"></div>');
        var $titleDiv = $('#all-content>.panel-heading');
        var $bodyDiv = $('#all-content>.panel-body');
        // 给头div添加内容<h4>
        $titleDiv.empty().append('<h4 class="panel-title">查看所教课程学生成绩</h4>')
        // 添加显示数据条数
        // $titleDiv.append('<div><div class="mydata_count"><label><span><select id="sel" size="1" name="datatable_length"><option value="3" selected="selected">3</option><option value="5">5</option><option value="10">10</option><option value="50">50</option></select></span>条数据</label></div><div><div id="datatable_filter"><label><input type="text" class="form-control input-large" placeholder="Search"></label></div></div></div>')

        //添加表格头部
        $bodyDiv.empty().append('<table class="table display" id="datatable1"></table>')
        var $table = $('.panel-body>.display');
        $.get('grade/teacher/showGrades',{Lno:"0002"},function(data){
            $table.append('<tbody></tbody>');
            var $body = $table.children('tbody');
            var sum = 0;
            for (var i = 0; i < data.length; i++) {
                sum += data[i].Gscore;
                var strTds = '<td>' + data[i].Sno + '</td>'
                    + '<td>' + data[i].Sname + '</td>'
                    + '<td>' + data[i].Lno + '</td>'
                    + '<td>' + data[i].Gscore + '</td>'
                var newTr = document.createElement('tr');
                $(newTr).append(strTds).appendTo($body);
            }
            var average = sum/data.length;
            $titleDiv.after('<div class="GPA">'+'平均分:'+`${average}`+'</div>');
            $table.empty()
            .append('<thead><tr><th>学号</th><th>学生姓名</th><th>课程号</th><th>得分</th></tr></thead>')
            .append($body)
            .append('<tfoot><tr><th>学号</th><th>学生姓名</th><th>课程号</th><th>得分</th></tr></tfoot>');
        });
    })
    // 点击账号和密码导航栏
    $('#nav-my-account').click(function(){
        var $allContent = $('#all-content').empty();
          // 清除客户区内容
          $allContent.empty().removeClass('out-border');
          // var $clientSite = $('#all-context');
          var $formWrapper = $allContent.append('<div class="form-wrapper account"></div>')
              .children('.form-wrapper');
          var $formTitle = $formWrapper.append('<div class="form-title">账号&密码</div>')
              .children('.form-title');
          var $formBody = $formWrapper.append('<div class="form-body"></div>')
              .children('.form-body');
          // 往body中添加,一个一个的需要写入数据的 div
          var $teacherForm = $formBody.append('<form id="teacher-form" target="_self" action="Tuser/teacher/updateAccountInfo" method="POST">')
            .children('#teacher-form');
        $.get('Tuser/teacher/getAccountInfo',{ID:1}, function (d) {
            for (var i = 0; i < d.length; i++) {

                $teacherForm.append(`<div class="form-li" id="form-li5"><label class="col-lg-2 col-md-2 col-sm-12 control-label">ID</label><div class="col-lg-10 col-md-10"><input readOnly value='${d[i].ID}' name="ID" type="text" class="form-control" placeholder="ID" autofocus="autofocus"></div></div>`)
                    .append(`<div class="form-li" id="form-li1"><label class="col-lg-2 col-md-2 col-sm-12 control-label">用户名</label><div class="col-lg-10 col-md-10"><input value='${d[i].Tuser}' type="text" name="Tuser" class="form-control" placeholder="字符长度 < 10且不含有中文" autofocus="autofocus"></div></div>`)
                    .append(`<div class="form-li" id="form-li2"><label class="col-lg-2 col-md-2 col-sm-12 control-label">邮&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp箱</label><div class="col-lg-10 col-md-10"><input value='${d[i].Temail}' name="Temail" type="text" class="form-control" placeholder="输入邮箱" autofocus="autofocus"></div></div>`)
                    .append(`<div class="form-li" id="form-li2"><label class="col-lg-2 col-md-2 col-sm-12 control-label">电&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp话</label><div class="col-lg-10 col-md-10"><input value='${d[i].Ttel}' name="Ttel" type="text" class="form-control" placeholder="输入合法电话号码" autofocus="autofocus"></div></div>`)                    
                    .append(`<div class="form-li" id="form-li3"><label class="col-lg-2 col-md-2 col-sm-12 control-label">重置密码</label><div class="col-lg-10 col-md-10"><input  name="TfirstPass" type="password" class="form-control" placeholder="请输入新密码" autofocus="autofocus"></div></div>`)
                    .append(`<div class="form-li" id="form-li4"><label class="col-lg-2 col-md-2 col-sm-12 control-label">确认密码</label><div class="col-lg-10 col-md-10"><input name="TsecondPass" type="password" class="form-control" placeholder="请再次输入密码" autofocus="autofocus"></div></div>`)
                $teacherForm.append('<input type="submit" value="修  改" class="btn btn-success btn-block">')
            }
            $('#form-li5').hide();
        })
        if($('#form-li3').attr('value') !== $('#form-li4').attr('value')){
            $('#form-li4').attr('value',"");
        }
       
    })

})